<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Warp Chat</title>
        <link rel="icon" href="data:," />

        <style>
            body {
                background-color: #303030;
                color: #dddddd;
            }
        </style>
    </head>
    <body>
        <h1>Warp chat</h1>

        <h3 id="room-name"></h3>

        <div id="chat">
            <p><em>Connecting...</em></p>
        </div>

        <input type="text" id="text" />

        <button type="button" id="send">Send</button>

        <script type="text/javascript">
            const roomName = document.getElementById('room-name');
            const chat = document.getElementById('chat');
            const text = document.getElementById('text');

            const roomId = location.pathname.split('/').at(-1);
            const uri = `ws://${location.host}/websocket/${roomId}`;
            const ws = new WebSocket(uri);

            const message = (data) => {
                const line = document.createElement('p');
                line.innerText = data;
                chat.appendChild(line);
            }

            ws.onopen = () => {
                chat.innerHTML = '<p><em>Connected!</em></p>';
                roomName.innerHTML = `Welcome to ${roomId} chat!`;
            };

            ws.onmessage = (msg) => {
                message(msg.data);
            };

            ws.onclose = () => {
                chat.getElementsByTagName('em')[0].innerText = 'Disconnected!';
            };

            send.onclick = () => {
                const msg = text.value;
                ws.send(msg);
                text.value = '';
                message('<You>: ' + msg);
            };
        </script>
    </body>
</html>
